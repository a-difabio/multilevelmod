<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>parsnip methods for hierarchical models — multilevelmod-package • multilevelmod</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../tidymodels.css" rel="stylesheet">




<meta property="og:title" content="parsnip methods for hierarchical models — multilevelmod-package" />
<meta property="og:description" content="multilevelmod allows users to use the parsnip package to fit certain
hierarchical models (e.g., linear, logistic, and Poisson regression). The
package relies on the formula method to specify the random effects." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">multilevelmod</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>parsnip methods for hierarchical models</h1>
    
    <div class="hidden name"><code>multilevelmod-package.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>multilevelmod allows users to use the <span class="pkg">parsnip</span> package to fit certain
hierarchical models (e.g., linear, logistic, and Poisson regression). The
package relies on the formula method to specify the random effects.</p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>As an example, the package includes simulated longitudinal data where
subjects were measured over time points. The outcome was the number of
counts and the predictors are the time point as well as an additional
numeric covariate.</p>
<p>We can fit the model using <code><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>lme4::glmer()</a></code>:<div class="sourceCode r"></p><pre><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>multilevelmod</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/poissonreg'>poissonreg</a></span><span class='op'>)</span> <span class='co'># current required for poisson_reg()</span>

<span class='co'># The lme4 package is required for this model.</span>

<span class='fu'>tidymodels_prefer</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Split out two subjects to show how prediction works</span>
<span class='va'>data_train</span> <span class='op'>&lt;-</span> 
  <span class='va'>longitudinal_counts</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>(</span><span class='va'>subject</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1"</span>, <span class='st'>"2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>data_new</span> <span class='op'>&lt;-</span> 
  <span class='va'>longitudinal_counts</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>subject</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1"</span>, <span class='st'>"2"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Fit the model</span>
<span class='va'>count_mod</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/poisson_reg.html'>poisson_reg</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"glmer"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>time</span> <span class='op'>+</span> <span class='va'>x</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>subject</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>data_train</span><span class='op'>)</span>
</pre><p></div><div class="sourceCode r"></p><pre><span class='va'>count_mod</span>
</pre><p></div></p><pre><span class='co'>## parsnip model object</span>
<span class='co'>## </span>
<span class='co'>## Fit time:  166ms </span>
<span class='co'>## Generalized linear mixed model fit by maximum likelihood (Laplace</span>
<span class='co'>##   Approximation) [glmerMod]</span>
<span class='co'>##  Family: poisson  ( log )</span>
<span class='co'>## Formula: y ~ time + x + (1 | subject)</span>
<span class='co'>##    Data: data</span>
<span class='co'>##       AIC       BIC    logLik  deviance  df.resid </span>
<span class='co'>##  4474.553  4494.104 -2233.277  4466.553       976 </span>
<span class='co'>## Random effects:</span>
<span class='co'>##  Groups  Name        Std.Dev.</span>
<span class='co'>##  subject (Intercept) 0.9394  </span>
<span class='co'>## Number of obs: 980, groups:  subject, 98</span>
<span class='co'>## Fixed Effects:</span>
<span class='co'>## (Intercept)         time            x  </span>
<span class='co'>##     -0.5946       1.5145       0.2395</span>
</pre>

<p>When making predictions, the basic <code><a href='https://rdrr.io/r/stats/predict.html'>predict()</a></code> method does the trick:<div class="sourceCode r"></p><pre><span class='va'>count_mod</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>data_new</span><span class='op'>)</span>
</pre><p></div></p><pre><span class='co'>## # A tibble: 20 × 1</span>
<span class='co'>##    .pred</span>
<span class='co'>##    &lt;dbl&gt;</span>
<span class='co'>##  1  1.19</span>
<span class='co'>##  2  1.42</span>
<span class='co'>##  3  1.65</span>
<span class='co'>##  4  1.83</span>
<span class='co'>##  5  2.04</span>
<span class='co'>##  6  2.66</span>
<span class='co'>##  7  2.96</span>
<span class='co'>##  8  3.43</span>
<span class='co'>##  9  3.94</span>
<span class='co'>## 10  4.64</span>
<span class='co'>## 11  2.21</span>
<span class='co'>## 12  2.60</span>
<span class='co'>## 13  2.97</span>
<span class='co'>## 14  3.38</span>
<span class='co'>## 15  4.16</span>
<span class='co'>## 16  4.90</span>
<span class='co'>## 17  5.45</span>
<span class='co'>## 18  6.20</span>
<span class='co'>## 19  7.55</span>
<span class='co'>## 20  8.64</span>
</pre>

    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p><strong>Maintainer</strong>: Max Kuhn <a href='mailto:max@rstudio.com'>max@rstudio.com</a> (<a href='https://orcid.org/0000-0003-2402-136X'>ORCID</a>)</p>
<p>Other contributors:</p><ul>
<li><p>RStudio [copyright holder]</p></li>
</ul>



  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>multilevelmod is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


